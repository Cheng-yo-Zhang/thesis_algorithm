# Parallel Insertion Construction — 完整 Trace (25 Customers)

## 參數速查

| MCS | UAV |
|-----|-----|
| Speed = 0.72 km/min | Speed = 1.0 km/min |
| Capacity = 270 kWh | Capacity = 20 kWh |
| Fast = 250 kW (urgent) | Fast = 50 kW |
| Slow = 11 kW (normal) | +3 min overhead |

**Depot** = (50, 50), due_date = 1440

**充電時間**: MCS-urgent = [(demand/250)×60](file:///c:/Users/Louis/thesis_algorithm/manual_calculation_25c.py#19-24), MCS-normal = [(demand/11)×60](file:///c:/Users/Louis/thesis_algorithm/manual_calculation_25c.py#19-24), UAV = [(demand/50)×60](file:///c:/Users/Louis/thesis_algorithm/manual_calculation_25c.py#19-24)

**行駛時間**: MCS = Manhattan/0.72, UAV = Euclidean/1.0 + 3

**排序**: `sort(key = (0 if urgent else 1, due_date))` → Urgent 優先 + EDD

---

## 排序後插入順序

| # | ID | Type | (X,Y) | Demand | Ready | Due | Sort Key |
|--:|---:|------|-------|-------:|------:|----:|----------|
| 1 | 24 | urgent | (2,100) | 15 | 297 | 382 | (0,382) |
| 2 | 4 | urgent | (60,20) | 30 | 554 | 639 | (0,639) |
| 3 | 13 | urgent | (59,20) | 6 | 799 | 865 | (0,865) |
| 4 | 20 | urgent | (14,61) | 7 | 1073 | 1162 | (0,1162) |
| 5 | 14 | urgent | (32,75) | 30 | 1245 | 1319 | (0,1319) |
| 6 | 21 | normal | (61,46) | 41 | 49 | 534 | (1,534) |
| 7 | 3 | normal | (14,71) | 17 | 71 | 553 | (1,553) |
| 8 | 15 | normal | (57,21) | 30 | 84 | 592 | (1,592) |
| 9 | 6 | normal | (74,74) | 24 | 69 | 627 | (1,627) |
| 10 | 7 | normal | (87,99) | 36 | 138 | 707 | (1,707) |
| 11 | 16 | normal | (88,48) | 11 | 221 | 713 | (1,713) |
| 12 | 10 | normal | (1,87) | 11 | 192 | 723 | (1,723) |
| 13 | 17 | normal | (90,58) | 21 | 308 | 858 | (1,858) |
| 14 | 9 | normal | (21,52) | 13 | 288 | 863 | (1,863) |
| 15 | 23 | normal | (54,63) | 10 | 355 | 918 | (1,918) |
| 16 | 26 | normal | (20,72) | 15 | 342 | 942 | (1,942) |
| 17 | 5 | normal | (82,86) | 34 | 469 | 962 | (1,962) |
| 18 | 25 | normal | (50,6) | 32 | 455 | 1031 | (1,1031) |
| 19 | 12 | normal | (1,63) | 22 | 487 | 1067 | (1,1067) |
| 20 | 2 | normal | (51,92) | 32 | 529 | 1107 | (1,1107) |
| 21 | 19 | normal | (59,79) | 34 | 606 | 1127 | (1,1127) |
| 22 | 22 | normal | (61,50) | 22 | 576 | 1163 | (1,1163) |
| 23 | 18 | normal | (41,91) | 12 | 644 | 1209 | (1,1209) |
| 24 | 8 | normal | (23,2) | 14 | 661 | 1217 | (1,1217) |
| 25 | 11 | normal | (29,37) | 23 | 775 | 1258 | (1,1258) |

---

## Step 1/25 — Node 24 (urgent, demand=15, ready=297, due=382)

**現有路徑**: 無

無路徑可插入 → 開新路徑，Node 24 是 urgent → 比較新 MCS vs 新 UAV:

**新 MCS 計算**:
- Depot(50,50) → Node24(2,100): Manhattan = |50-2|+|50-100| = 98, travel = 98/0.72 = **136.11 min**
- actual_departure = max(0, ready=297) = 297
- arrival = 297 + 136.11 = **433.11** > due=382 → ❌ **到達超時！不可行**

**新 UAV 計算**:
- Depot → Node24: Euclidean = √(48²+50²) = 69.31, travel = 69.31/1.0 + 3 = **72.31 min**
- actual_departure = max(0, 297) = 297
- arrival = 297 + 72.31 = **369.31** ≤ 382 ✓
- charge = (15/50)×60 = **18.00 min**, departure = 369.31 + 18.00 = **387.31** > due=382 → ❌ **充電完成超時！不可行**

> **結果**: MCS 不可行、UAV 不可行 → **Node 24 加入未分配 (unassigned)**

---

## Step 2/25 — Node 4 (urgent, demand=30, ready=554, due=639)

**現有路徑**: 無

開新路徑，Node 4 是 urgent → 比較新 MCS vs 新 UAV:

**新 MCS**:
- Depot(50,50) → Node4(60,20): Manhattan = 10+30 = 40, travel = 40/0.72 = **55.56 min**
- depart = max(0, 554) = 554, arrival = 554 + 55.56 = **609.56** ≤ 639 ✓
- charge(FAST) = (30/250)×60 = **7.20 min**, departure = 616.76 ≤ 639 ✓
- user_wait = 609.56 − 554 = **55.56**, **可行 ✓**

**新 UAV**:
- Depot → Node4: Euclidean = √(10²+30²) = 31.62, travel = 31.62 + 3 = **34.62 min**
- arrival = 554 + 34.62 = **588.62** ≤ 639 ✓
- charge = (30/50)×60 = **36.00 min**... 但 demand=30 > UAV capacity=20 → ❌ **載重超限！不可行**

> **結果**: MCS wait=55.56 vs UAV=∞ → **開 MCS-0，選 MCS**
> **MCS-0** = `[4]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 4 | 609.56 | 616.76 | FAST | 55.56 |

---

## Step 3/25 — Node 13 (urgent, demand=6, ready=799, due=865)

**現有路徑**: MCS-0 `[4]`, UAV: 無

**評估 MCS-0** `[4]`:

| pos | 插入位置 | 可行? | Δwait | 說明 |
|----:|---------|:-----:|------:|------|
| 0 | Depot→**[13]**→4 | ❌ | ∞ | 從 depot 出發需等到 ready=799，到 Node13 後再去 Node4，Node4 的 arrival 會超時 |
| 1 | 4→**[13]**→Depot | ✓ | **1.39** | Node4 departure=616.76, depart_to_13=max(616.76, 799)=799, travel(4→13)=(|60−59|+|20−20|)/0.72=1.39, arrival=800.39≤865✓ |

**評估 UAV** (urgent 可用 UAV): 無 UAV 路徑

> **結果**: 唯一可行 = MCS-0 pos=1, Δwait=1.39 → **插入 MCS-0 pos=1**
> **MCS-0** = `[4, 13]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 4 | 609.56 | 616.76 | FAST | 55.56 |
| 13 | 800.39 | 801.83 | FAST | 1.39 |

---

## Step 4/25 — Node 20 (urgent, demand=7, ready=1073, due=1162)

**現有路徑**: MCS-0 `[4,13]`, UAV: 無

**評估 MCS-0** `[4, 13]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[20]**→4 | ❌ | ∞ |
| 1 | 4→**[20]**→13 | ❌ | ∞ |
| 2 | 13→**[20]**→Depot | ❌ | ∞ |

> 所有位置不可行 (Node 20 ready=1073 很晚，插入會延後後續節點，但 Node20 本身在末尾也不行，因 13 的 departure=801.83, max(801.83,1073)=1073, travel(13→20)=(|59−14|+|20−61|)/0.72=45+41)/0.72=119.44, arrival=1073+119.44=1192.44 > due=1162 ❌)

**評估 UAV**: 無 UAV 路徑

開新路徑，Node 20 是 urgent → 比較新 MCS vs 新 UAV:

**新 MCS**:
- Depot→Node20: Manhattan = |50−14|+|50−61| = 36+11 = 47, travel = 47/0.72 = **65.28 min**
- depart=max(0,1073)=1073, arrival=1073+65.28=**1138.28** ≤ 1162 ✓
- charge(FAST) = (7/250)×60 = **1.68**, departure=1139.96 ≤ 1162 ✓
- wait = **65.28**, **可行 ✓**

**新 UAV**:
- Depot→Node20: Euclidean = √(36²+11²) = 37.64, travel = 37.64+3 = **40.64 min**
- arrival = 1073+40.64 = **1113.64** ≤ 1162 ✓
- charge = (7/50)×60 = **8.40**, departure=1122.04 ≤ 1162 ✓
- wait = **40.64**, **可行 ✓**

> **結果**: UAV wait=40.64 ≤ MCS wait=65.28 → **開 UAV-0，選 UAV**
> **UAV-0** = `[20]`

---

## Step 5/25 — Node 14 (urgent, demand=30, ready=1245, due=1319)

**現有路徑**: MCS-0 `[4,13]`, UAV-0 `[20]`

**評估 MCS-0** `[4, 13]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[14]**→4 | ❌ | ∞ |
| 1 | 4→**[14]**→13 | ❌ | ∞ |
| 2 | 13→**[14]**→Depot | ❌ | ∞ |

**評估 UAV-0** `[20]` (urgent 可用 UAV):

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[14]**→20 | ❌ | ∞ |
| 1 | 20→**[14]**→Depot | ❌ | ∞ (demand=30 > UAV capacity=20) |

開新路徑:

**新 MCS**: Depot→Node14: Manhattan=|50−32|+|50−75|=18+25=43, travel=43/0.72=**59.72 min**
- arrival=1245+59.72=**1304.72** ≤ 1319 ✓, charge(FAST)=(30/250)×60=7.20, dep=1311.92 ≤ 1319 ✓
- wait=**59.72**, **可行 ✓**

**新 UAV**: demand=30 > capacity=20 → ❌ **不可行**

> **結果**: MCS wait=59.72 → **開 MCS-1**
> **MCS-1** = `[14]`

---

## Step 6/25 — Node 21 (normal, demand=41, ready=49, due=534)

**現有路徑**: MCS-0 `[4,13]`, MCS-1 `[14]`, UAV-0 `[20]`
Normal 節點 → **不評估 UAV**

**評估 MCS-0** `[4, 13]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[21]**→4 | ✓ | **20.83** ★ |
| 1 | 4→**[21]**→13 | ❌ | ∞ |
| 2 | 13→**[21]**→Depot | ❌ | ∞ |

> pos=0: depart=max(0, 49)=49, travel(Depot→21)=(|50−61|+|50−46|)/0.72=15/0.72=20.83, arrival=49+20.83=69.83 ≤ 534 ✓
> charge(SLOW)=(41/11)×60=223.64, departure=293.47, 後續 Node4: depart_to_4=max(293.47, 554)=554, travel(21→4)=40.28, arrival=594.28 ≤ 639 ✓，全部前向傳播通過

**評估 MCS-1** `[14]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[21]**→14 | ❌ | ∞ |
| 1 | 14→**[21]**→Depot | ❌ | ∞ |

> **結果**: 全局最佳 = MCS-0 pos=0, Δwait=20.83 → **插入 MCS-0 pos=0**
> **MCS-0** = `[21, 4, 13]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 21 | 69.83 | 293.47 | SLOW | 20.83 |
| 4 | 591.50 | 598.70 | FAST | 37.50 |
| 13 | 800.39 | 801.83 | FAST | 1.39 |

---

## Step 7/25 — Node 3 (normal, demand=17, ready=71, due=553)

**現有路徑**: MCS-0 `[21,4,13]`, MCS-1 `[14]`

**評估 MCS-0** `[21, 4, 13]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[3]**→21 | ❌ | ∞ |
| 1 | 21→**[3]**→4 | ❌ | ∞ |
| 2 | 4→**[3]**→13 | ❌ | ∞ |
| 3 | 13→**[3]**→Depot | ❌ | ∞ |

**評估 MCS-1** `[14]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[3]**→14 | ✓ | **79.17** ★ |
| 1 | 14→**[3]**→Depot | ❌ | ∞ |

> pos=0: depart=max(0,71)=71, travel(Depot→3)=(|50−14|+|50−71|)/0.72=57/0.72=79.17, arrival=71+79.17=150.17 ≤ 553 ✓
> charge(SLOW)=(17/11)×60=92.73, departure=242.89; 後續 Node14 不受影響 (ready=1245 >> 242.89)

> **結果**: MCS-1 pos=0, Δwait=79.17 → **插入 MCS-1 pos=0**
> **MCS-1** = `[3, 14]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 3 | 150.17 | 242.89 | SLOW | 79.17 |
| 14 | 1275.56 | 1282.76 | FAST | 30.56 |

---

## Step 8/25 — Node 15 (normal, demand=30, ready=84, due=592)

**現有路徑**: MCS-0 `[21,4,13]`, MCS-1 `[3,14]`

**評估 MCS-0** `[21, 4, 13]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[15]**→21 | ❌ | ∞ |
| 1 | 21→**[15]**→4 | ✓ | **249.75** ★ |
| 2 | 4→**[15]**→13 | ❌ | ∞ |
| 3 | 13→**[15]**→Depot | ❌ | ∞ |

> pos=1: 21 departure=293.47, depart_to_15=max(293.47, 84)=293.47, travel(21→15)=(|61−57|+|46−21|)/0.72=29/0.72=40.28, arrival=293.47+40.28=333.75 ≤ 592 ✓
> charge(SLOW)=(30/11)×60=163.64, departure=497.38; 後續 Node4: depart_to_4=max(497.38, 554)=554, travel(15→4)=(|57−60|+|21−20|)/0.72=4/0.72=5.56, arrival=559.56 ≤ 639 ✓
> wait_15 = 333.75 − 84 = 249.75

**評估 MCS-1** `[3, 14]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[15]**→3 | ✓ | **326.64** |
| 1 | 3→**[15]**→14 | ❌ | ∞ |
| 2 | 14→**[15]**→Depot | ❌ | ∞ |

> **結果**: MCS-0 pos=1 (249.75) < MCS-1 pos=0 (326.64) → **插入 MCS-0 pos=1**
> **MCS-0** = `[21, 15, 4, 13]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 21 | 69.83 | 293.47 | SLOW | 20.83 |
| 15 | 333.75 | 497.38 | SLOW | 249.75 |
| 4 | 559.56 | 566.76 | FAST | 5.56 |
| 13 | 800.39 | 801.83 | FAST | 1.39 |

---

## Step 9/25 — Node 6 (normal, demand=24, ready=69, due=627)

**現有路徑**: MCS-0 `[21,15,4,13]`, MCS-1 `[3,14]`

**評估 MCS-0** `[21, 15, 4, 13]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[6]**→21 | ❌ | ∞ |
| 1 | 21→**[6]**→15 | ❌ | ∞ |
| 2 | 15→**[6]**→4 | ❌ | ∞ |
| 3 | 4→**[6]**→13 | ❌ | ∞ |
| 4 | 13→**[6]**→Depot | ❌ | ∞ |

**評估 MCS-1** `[3, 14]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[6]**→3 | ✓ | **270.58** ★ |
| 1 | 3→**[6]**→14 | ✓ | 290.56 |
| 2 | 14→**[6]**→Depot | ❌ | ∞ |

> pos=0 比 pos=1 好 (270.58 < 290.56)
> pos=0: depart=max(0,69)=69, travel(Depot→6)=(|50−74|+|50−74|)/0.72=48/0.72=66.67, arrival=69+66.67=135.67 ≤ 627 ✓
> charge(SLOW)=(24/11)×60=130.91, departure=266.58; 前向傳播: Node3 到達延後但 ready=71 遠大於被吸收

> **結果**: MCS-1 pos=0, Δwait=270.58 → **插入 MCS-1 pos=0**
> **MCS-1** = `[6, 3, 14]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 6 | 135.67 | 266.58 | SLOW | 66.67 |
| 3 | 354.08 | 446.80 | SLOW | 283.08 |
| 14 | 1275.56 | 1282.76 | FAST | 30.56 |

---

## Step 10/25 — Node 7 (normal, demand=36, ready=138, due=707)

**現有路徑**: MCS-0 `[21,15,4,13]`, MCS-1 `[6,3,14]`

**評估 MCS-0** `[21, 15, 4, 13]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ❌ | ∞ |
| 1 | ❌ | ∞ |
| 2 | ❌ | ∞ |
| 3 | ❌ | ∞ |
| 4 | ❌ | ∞ |

**評估 MCS-1** `[6, 3, 14]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ❌ | ∞ |
| 1 | ❌ | ∞ |
| 2 | ❌ | ∞ |
| 3 | ❌ | ∞ |

> 所有位置不可行 (SLOW 充電 196.36 min 太長，插入任何位置都會連鎖超時)

**開新 MCS-2**:
- Depot→Node7: Manhattan=(|50−87|+|50−99|)=37+49=86, travel=86/0.72=**119.44 min**
- depart=max(0,138)=138, arrival=138+119.44=**257.44** ≤ 707 ✓
- charge(SLOW)=(36/11)×60=196.36, departure=453.81 ≤ 707 ✓
- wait=**119.44**, **可行 ✓** → **開 MCS-2**

> **MCS-2** = `[7]`

---

## Step 11/25 — Node 16 (normal, demand=11, ready=221, due=713)

**現有路徑**: MCS-0 `[21,15,4,13]`, MCS-1 `[6,3,14]`, MCS-2 `[7]`

**評估 MCS-0**: 全 5 個位置 ❌

**評估 MCS-1** `[6, 3, 14]`: 全 4 個位置 ❌

**評估 MCS-2** `[7]`:

| pos | 插入位置 | 可行? | Δwait |
|----:|---------|:-----:|------:|
| 0 | Depot→**[16]**→7 | ✓ | **206.89** ★ |
| 1 | 7→**[16]**→Depot | ✓ | 305.03 |

> pos=0 (206.89) < pos=1 (305.03)
> pos=0: depart=max(0,221)=221, travel(Depot→16)=(|50−88|+|50−48|)/0.72=40/0.72=55.56, arrival=221+55.56=276.56 ≤ 713 ✓
> charge(SLOW)=(11/11)×60=60.00, departure=336.56; Node7: depart=max(336.56, 138)=336.56, travel(16→7)=(|88−87|+|48−99|)/0.72=52/0.72=72.22, arrival=408.78 ≤ 707 ✓

> **結果**: MCS-2 pos=0, Δwait=206.89 → **插入 MCS-2 pos=0**
> **MCS-2** = `[16, 7]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 16 | 276.56 | 336.56 | SLOW | 55.56 |
| 7 | 408.78 | 605.14 | SLOW | 270.78 |

---

## Step 12/25 — Node 10 (normal, demand=11, ready=192, due=723)

**現有路徑**: MCS-0 `[21,15,4,13]`, MCS-1 `[6,3,14]`, MCS-2 `[16,7]`

**MCS-0**: 全 5 個位置 ❌

**MCS-1** `[6, 3, 14]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ❌ | ∞ |
| 1 | ❌ | ∞ |
| 2 | ✓ | **324.25** ★ |
| 3 | ❌ | ∞ |

> pos=2 (3→**[10]**→14): Node3 departure=446.80, depart=max(446.80, 192)=446.80, travel(3→10)=(|14−1|+|71−87|)/0.72=29/0.72=40.28, arrival=487.08 ≤ 723 ✓
> charge(SLOW)=60.00, dep=547.08; Node14 不受影響 (ready=1245 >> dep)

**MCS-2** `[16, 7]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ❌ | ∞ |
| 1 | ❌ | ∞ |
| 2 | ❌ | ∞ |

> **結果**: MCS-1 pos=2, Δwait=324.25 → **插入 MCS-1 pos=2**
> **MCS-1** = `[6, 3, 10, 14]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 6 | 135.67 | 266.58 | SLOW | 66.67 |
| 3 | 354.08 | 446.80 | SLOW | 283.08 |
| 10 | 487.08 | 547.08 | SLOW | 295.08 |
| 14 | 1304.72 | 1311.92 | FAST | 59.72 |

---

## Step 13/25 — Node 17 (normal, demand=21, ready=308, due=858)

**MCS-0**: 全 5 pos ❌ | **MCS-1** `[6,3,10,14]`: 全 5 pos ❌

**MCS-2** `[16, 7]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ❌ | ∞ |
| 1 | ❌ | ∞ |
| 2 | ✓ | **358.25** ★ |

> pos=2 (7→**[17]**→Depot): Node7 departure=605.14, depart=max(605.14, 308)=605.14, travel(7→17)=(|87−90|+|99−58|)/0.72=44/0.72=61.11, arrival=666.25 ≤ 858 ✓
> charge(SLOW)=(21/11)×60=114.55, dep=780.80 ≤ 858 ✓

> **結果**: MCS-2 pos=2, Δwait=358.25 → **插入 MCS-2 pos=2**
> **MCS-2** = `[16, 7, 17]`

---

## Step 14/25 — Node 9 (normal, demand=13, ready=288, due=863)

**MCS-0**: 全 5 pos ❌ | **MCS-2** `[16,7,17]`: 全 4 pos ❌

**MCS-1** `[6, 3, 10, 14]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ❌ | ∞ |
| 1 | ❌ | ∞ |
| 2 | ✓ | 338.05 |
| 3 | ✓ | **335.47** ★ |
| 4 | ❌ | ∞ |

> pos=3 (10→**[9]**→14): Node10 dep=547.08, depart=max(547.08, 288)=547.08, travel(10→9)=(|1−21|+|87−52|)/0.72=55/0.72=76.39, arrival=623.47 ≤ 863 ✓
> charge(SLOW)=(13/11)×60=70.91, dep=694.38; Node14 ready=1245 不受影響
> pos=3 Δwait=335.47 < pos=2 Δwait=338.05

> **結果**: MCS-1 pos=3, Δwait=335.47 → **插入 MCS-1 pos=3**
> **MCS-1** = `[6, 3, 10, 9, 14]`

---

## Step 15/25 — Node 23 (normal, demand=10, ready=355, due=918)

**MCS-0**: 全 5 pos ❌ | **MCS-2** `[16,7,17]`: 全 4 pos ❌ (包含 pos=3 Δwait=482.74)

**MCS-1** `[6, 3, 10, 9, 14]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–2 | ❌ | ∞ |
| 3 | ✓ | 445.24 |
| 4 | ✓ | **400.49** ★ |
| 5 | ❌ | ∞ |

> pos=4 (9→**[23]**→14): Node9 dep=694.38, depart=max(694.38, 355)=694.38, travel(9→23)=(|21−54|+|52−63|)/0.72=44/0.72=61.11, arrival=755.49 ≤ 918 ✓
> charge(SLOW)=(10/11)×60=54.55, dep=810.04; Node14 不受影響

> **結果**: MCS-1 pos=4, Δwait=400.49 → **插入 MCS-1 pos=4**
> **MCS-1** = `[6, 3, 10, 9, 23, 14]`

---

## Step 16/25 — Node 26 (normal, demand=15, ready=342, due=942)

**MCS-0**: 全 5 pos ❌ | **MCS-2**: 全 4 pos ❌

**MCS-1** `[6, 3, 10, 9, 23, 14]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–1 | ❌ | ∞ |
| 2 | ✓ | **409.98** ★ |
| 3 | ✓ | 415.94 |
| 4–6 | ❌ | ∞ |

> pos=2 (3→**[26]**→10): Node3 dep=446.80, depart=max(446.80, 342)=446.80, travel(3→26)=(|14−20|+|71−72|)/0.72=7/0.72=9.72, arrival=456.53 ≤ 942 ✓
> charge(SLOW)=(15/11)×60=81.82, dep=538.34; 前向傳播 Node10: arrival shift 但仍 ≤ 723
> pos=2 (409.98) < pos=3 (415.94)

> **結果**: MCS-1 pos=2, Δwait=409.98 → **插入 MCS-1 pos=2**
> **MCS-1** = `[6, 3, 26, 10, 9, 23, 14]`

| Node | Arrival | Departure | Mode | Wait |
|------|--------:|----------:|------|-----:|
| 6 | 135.67 | 266.58 | SLOW | 66.67 |
| 3 | 354.08 | 446.80 | SLOW | 283.08 |
| 26 | 456.53 | 538.34 | SLOW | 114.53 |
| 10 | 585.57 | 645.57 | SLOW | 393.57 |
| 9 | 721.95 | 792.86 | SLOW | 433.95 |
| 23 | 853.97 | 908.52 | SLOW | 498.97 |
| 14 | 1292.22 | 1299.42 | FAST | 47.22 |

---

## Step 17/25 — Node 5 (normal, demand=34, ready=469, due=962)

**MCS-0**: 全 5 pos ❌ | **MCS-1**: 全 8 pos ❌ | **MCS-2**: 全 4 pos ❌

> 所有現有路徑均不可行

**開新 MCS-3**:
- Depot→Node5: Manhattan=(|50−82|+|50−86|)=32+36=68, travel=68/0.72=**94.44 min**
- depart=max(0,469)=469, arrival=469+94.44=563.44 ≤ 962 ✓
- charge(SLOW)=(34/11)×60=185.45, dep=748.90 ≤ 962 ✓, wait=**94.44** ✓

> **MCS-3** = `[5]`

---

## Step 18/25 — Node 25 (normal, demand=32, ready=455, due=1031)

**MCS-0** `[21,15,4,13]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–2 | ❌ | ∞ |
| 3 | ✓ | **175.64** ★ |
| 4 | ✓ | 378.77 |

> pos=3 (4→**[25]**→13): Node4 dep=566.76, depart=max(566.76,455)=566.76, travel(4→25)=(|60−50|+|20−6|)/0.72=24/0.72=33.33, arrival=600.09 ≤ 1031 ✓
> charge(SLOW)=(32/11)×60=174.55, dep=774.63; Node13: depart=max(774.63, 799)=799, travel(25→13)=(|50−59|+|6−20|)/0.72=23/0.72=31.94, arrival=830.94 ≤ 865 ✓

**MCS-1**: 全 8 pos ❌ | **MCS-2**: 全 4 pos ❌ | **MCS-3** `[5]`: 全 2 pos ❌

> **結果**: MCS-0 pos=3, Δwait=175.64 → **插入 MCS-0 pos=3**
> **MCS-0** = `[21, 15, 4, 25, 13]`

---

## Step 19/25 — Node 12 (normal, demand=22, ready=487, due=1067)

**MCS-0**: 全 6 pos ❌ | **MCS-1**: 全 8 pos ❌ | **MCS-2**: 全 4 pos ❌

**MCS-3** `[5]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ❌ | ∞ |
| 1 | ✓ | **406.34** ★ |

> pos=1 (5→**[12]**→Depot): Node5 dep=748.90, depart=max(748.90,487)=748.90, travel(5→12)=(|82−1|+|86−63|)/0.72=104/0.72=144.44, arrival=893.34 ≤ 1067 ✓
> charge(SLOW)=(22/11)×60=120.00, dep=1013.34

**MCS-2** pos=3 也有 Δwait=424.35，但 406.34 < 424.35

> **結果**: MCS-3 pos=1, Δwait=406.34 → **插入 MCS-3 pos=1**
> **MCS-3** = `[5, 12]`

---

## Step 20/25 — Node 2 (normal, demand=32, ready=529, due=1107)

**MCS-0**: 全 6 pos ❌ | **MCS-1**: 全 8 pos ❌ | **MCS-3** `[5,12]`: 全 3 pos ❌

**MCS-2** `[16, 7, 17]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–2 | ❌ | ∞ |
| 3 | ✓ | **353.19** ★ |

> pos=3 (17→**[2]**→Depot): Node17 dep=780.80, depart=max(780.80,529)=780.80, travel(17→2)=(|90−51|+|58−92|)/0.72=73/0.72=101.39, arrival=882.19 ≤ 1107 ✓
> charge(SLOW)=(32/11)×60=174.55, dep=1056.73 ≤ 1107 ✓

> **結果**: MCS-2 pos=3, Δwait=353.19 → **插入 MCS-2 pos=3**
> **MCS-2** = `[16, 7, 17, 2]`

---

## Step 21/25 — Node 19 (normal, demand=34, ready=606, due=1127)

**MCS-1**: 全 8 pos ❌ | **MCS-2**: 全 5 pos ❌ | **MCS-3**: 全 3 pos ❌

**MCS-0** `[21, 15, 4, 25, 13]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–4 | ❌ | ∞ |
| 5 | ✓ | **308.33** ★ |

> pos=5 (13→**[19]**→Depot): Node13 dep=832.38, depart=max(832.38,606)=832.38, travel(13→19)=(|59−59|+|20−79|)/0.72=59/0.72=81.94, arrival=914.33 ≤ 1127 ✓
> charge(SLOW)=(34/11)×60=185.45, dep=1099.78 ≤ 1127 ✓

**MCS-1** pos=6 也有 Δwait=331.69，但 308.33 < 331.69

> **結果**: MCS-0 pos=5, Δwait=308.33 → **插入 MCS-0 pos=5**
> **MCS-0** = `[21, 15, 4, 25, 13, 19]`

---

## Step 22/25 — Node 22 (normal, demand=22, ready=576, due=1163)

**MCS-0**: 全 7 pos ❌ | **MCS-1**: 全 8 pos ❌ | **MCS-2**: 全 5 pos ❌ | **MCS-3**: 全 3 pos ❌

> 所有現有路徑均不可行

**開新 MCS-4**:
- Depot→Node22: Manhattan=(|50−61|+|50−50|)=11, travel=11/0.72=**15.28 min**
- depart=max(0,576)=576, arrival=576+15.28=591.28 ≤ 1163 ✓
- charge(SLOW)=(22/11)×60=120.00, dep=711.28, wait=**15.28** ✓

> **MCS-4** = `[22]`

---

## Step 23/25 — Node 18 (normal, demand=12, ready=644, due=1209)

**MCS-0**: 全 7 pos ❌ | **MCS-3**: 全 3 pos ❌

**MCS-1** `[6,3,26,10,9,23,14]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–5 | ❌ | ∞ |
| 6 | ✓ | 321.46 |
| 7 | ❌ | ∞ |

**MCS-2** `[16,7,17,2]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–3 | ❌ | ∞ |
| 4 | ✓ | 428.01 |

**MCS-3** `[5,12]` pos=2: ✓ Δwait=463.79

**MCS-4** `[22]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ✓ | 341.79 |
| 1 | ✓ | **152.00** ★ |

> pos=1 (22→**[18]**→Depot): Node22 dep=711.28, depart=max(711.28,644)=711.28, travel(22→18)=(|61−41|+|50−91|)/0.72=61/0.72=84.72, arrival=796.00 ≤ 1209 ✓
> charge(SLOW)=(12/11)×60=65.45, dep=861.45
> wait=796.00−644=**152.00** ← 遠低於其他候選

> **結果**: MCS-4 pos=1, Δwait=152.00 → **插入 MCS-4 pos=1**
> **MCS-4** = `[22, 18]`

---

## Step 24/25 — Node 8 (normal, demand=14, ready=661, due=1217)

**MCS-0**: 全 7 pos ❌ | **MCS-1**: 全 8 pos ❌ | **MCS-2**: 全 5 pos ❌

**MCS-3** `[5, 12]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–1 | ❌ | ∞ |
| 2 | ✓ | 467.62 |

**MCS-4** `[22, 18]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0 | ❌ | ∞ |
| 1 | ✓ | 429.42 |
| 2 | ✓ | **349.07** ★ |

> pos=2 (18→**[8]**→Depot): Node18 dep=861.45, depart=max(861.45,661)=861.45, travel(18→8)=(|41−23|+|91−2|)/0.72=107/0.72=148.61, arrival=1010.07 ≤ 1217 ✓
> charge(SLOW)=(14/11)×60=76.36, dep=1086.43
> wait=1010.07−661=**349.07**

> **結果**: MCS-4 pos=2, Δwait=349.07 → **插入 MCS-4 pos=2**
> **MCS-4** = `[22, 18, 8]`

---

## Step 25/25 — Node 11 (normal, demand=23, ready=775, due=1258)

**MCS-0**: 全 7 pos ❌ | **MCS-2**: 全 5 pos ❌

**MCS-1** `[6, 3, 26, 10, 9, 23, 14]`:

| pos | 可行? | Δwait |
|----:|:-----:|------:|
| 0–5 | ❌ | ∞ |
| 6 | ✓ | **214.08** ★ |
| 7 | ❌ | ∞ |

> pos=6 (23→**[11]**→14): Node23 dep=908.52, depart=max(908.52,775)=908.52, travel(23→11)=(|54−29|+|63−37|)/0.72=51/0.72=70.83, arrival=979.35 ≤ 1258 ✓
> charge(SLOW)=(23/11)×60=125.45, dep=1104.81; Node14: depart=max(1104.81,1245)=1245, arrival=1245+59.72=1304.72... 但 Node14 到達會從 1292.22 延後到 1301.94, 仍 ≤ 1319 ✓

**MCS-3** `[5, 12]`: pos=2 ✓ Δwait=313.34

**MCS-4** `[22, 18, 8]`: pos=2 ✓ Δwait=303.58

> 214.08 < 303.58 < 313.34

> **結果**: MCS-1 pos=6, Δwait=214.08 → **插入 MCS-1 pos=6**
> **MCS-1** = `[6, 3, 26, 10, 9, 23, 11, 14]`

---

## 最終解

### MCS-0: `Depot → 21 → 15 → 4 → 25 → 13 → 19 → Depot` (demand=173)

| # | Node | Type | Arrival | Departure | Mode | User Wait |
|--:|-----:|------|--------:|----------:|------|----------:|
| 0 | 21 | normal | 69.83 | 293.47 | SLOW | 20.83 |
| 1 | 15 | normal | 333.75 | 497.38 | SLOW | 249.75 |
| 2 | **4** | **urgent** | 559.56 | 566.76 | FAST | 5.56 |
| 3 | 25 | normal | 600.09 | 774.63 | SLOW | 145.09 |
| 4 | **13** | **urgent** | 830.94 | 832.38 | FAST | 31.94 |
| 5 | 19 | normal | 914.33 | 1099.78 | SLOW | 308.33 |

### MCS-1: `Depot → 6 → 3 → 26 → 10 → 9 → 23 → 11 → 14 → Depot` (demand=143)

| # | Node | Type | Arrival | Departure | Mode | User Wait |
|--:|-----:|------|--------:|----------:|------|----------:|
| 0 | 6 | normal | 135.67 | 266.58 | SLOW | 66.67 |
| 1 | 3 | normal | 354.08 | 446.80 | SLOW | 283.08 |
| 2 | 26 | normal | 456.53 | 538.34 | SLOW | 114.53 |
| 3 | 10 | normal | 585.57 | 645.57 | SLOW | 393.57 |
| 4 | 9 | normal | 721.95 | 792.86 | SLOW | 433.95 |
| 5 | 23 | normal | 853.97 | 908.52 | SLOW | 498.97 |
| 6 | 11 | normal | 979.35 | 1104.81 | SLOW | 204.35 |
| 7 | **14** | **urgent** | 1301.94 | 1309.14 | FAST | 56.94 |

### MCS-2: `Depot → 16 → 7 → 17 → 2 → Depot` (demand=100)

| # | Node | Arrival | Departure | Mode | User Wait |
|--:|-----:|--------:|----------:|------|----------:|
| 0 | 16 | 276.56 | 336.56 | SLOW | 55.56 |
| 1 | 7 | 408.78 | 605.14 | SLOW | 270.78 |
| 2 | 17 | 666.25 | 780.80 | SLOW | 358.25 |
| 3 | 2 | 882.19 | 1056.73 | SLOW | 353.19 |

### MCS-3: `Depot → 5 → 12 → Depot` (demand=56)

| # | Node | Arrival | Departure | Mode | User Wait |
|--:|-----:|--------:|----------:|------|----------:|
| 0 | 5 | 563.44 | 748.90 | SLOW | 94.44 |
| 1 | 12 | 893.34 | 1013.34 | SLOW | 406.34 |

### MCS-4: `Depot → 22 → 18 → 8 → Depot` (demand=48)

| # | Node | Arrival | Departure | Mode | User Wait |
|--:|-----:|--------:|----------:|------|----------:|
| 0 | 22 | 591.28 | 711.28 | SLOW | 15.28 |
| 1 | 18 | 796.00 | 861.45 | SLOW | 152.00 |
| 2 | 8 | 1010.07 | 1086.43 | SLOW | 349.07 |

### UAV-0: `Depot → 20 → Depot` (demand=7)

| # | Node | Type | Arrival | Departure | Mode | User Wait |
|--:|-----:|------|--------:|----------:|------|----------:|
| 0 | **20** | **urgent** | 1113.64 | 1122.04 | FAST | 40.64 |

### 統計

| 指標 | 值 |
|------|-----|
| 車輛 | 5 MCS + 1 UAV |
| 覆蓋率 | 24/25 (96%) — Node 24 未服務 |
| 平均用戶等待時間 | **204.55 min** |
| 總用戶等待時間 | 4909.11 min |
| 目標函數 | 10000×1 + 1.0×204.55 + 0.01×1393.29 = **10218.48** |
| MCS 快充 / 慢充 | 3 / 20 次 |
